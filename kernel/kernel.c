#include \"../include/kernel.h\"\n#include \"../include/vga.h\"\n#include \"../include/keyboard.h\"\n\n// Declaración de función\nint strcmp(const char* str1, const char* str2);\nint strncmp(const char* str1, const char* str2, int n);\nvoid print_number(int num);\nvoid show_memory_info(void);\nvoid show_system_time(void);\nvoid calculator(const char* expression);\nvoid show_processes(void);\nvoid list_files(void);\nvoid echo_command(const char* text);\nvoid show_detailed_system_info(void);\nvoid show_banner(void);\nvoid system_monitor(void);\nvoid show_advanced_help(void);\nvoid process_advanced_command(const char* cmd);\n\nvoid show_welcome_screen(void) {\n    vga_clear();\n    vga_set_color(vga_entry_color(VGA_COLOR_LIGHT_CYAN, VGA_COLOR_BLACK));\n    \n    vga_writestring(\"=============================================\\n\");\n    vga_writestring(\"          Bienvenido a OriginOS v2.0         \\n\");\n    vga_writestring(\"=============================================\\n\\n\");\n    \n    vga_set_color(vga_entry_color(VGA_COLOR_WHITE, VGA_COLOR_BLACK));\n    vga_writestring(\"Sistema operativo desarrollado desde cero\\n\");\n    vga_writestring(\"Autor: Enrique Mendoza\\n\");\n    vga_writestring(\"Version: 2.0.0 - Shell Avanzado\\n\\n\");\n    \n    vga_set_color(vga_entry_color(VGA_COLOR_LIGHT_GREEN, VGA_COLOR_BLACK));\n    vga_writestring(\"Kernel inicializado correctamente!\\n\");\n    vga_writestring(\"Componentes cargados:\\n\");\n    vga_writestring(\"  ✓ VGA Text Mode Driver\\n\");\n    vga_writestring(\"  ✓ Keyboard Driver Optimizado\\n\");\n    vga_writestring(\"  ✓ Shell v2.0 con Control Avanzado\\n\");\n    vga_writestring(\"  ✓ Sistema de Comandos Expandido\\n\\n\");\n    \n    vga_set_color(vga_entry_color(VGA_COLOR_LIGHT_BROWN, VGA_COLOR_BLACK));\n    vga_writestring(\"Nuevas funciones: calc, echo, ps, ls, reboot\\n\");\n    vga_writestring(\"Escribe 'help' para ver todos los comandos\\n\\n\");\n    vga_writestring(\"Presiona cualquier tecla para continuar...\\n\");\n}\n\nvoid simple_shell(void) {\n    vga_clear();\n    vga_set_color(vga_entry_color(VGA_COLOR_WHITE, VGA_COLOR_BLACK));\n    vga_writestring(\"OriginOS Shell v2.0 - Control Avanzado\\n\");\n    vga_writestring(\"Comandos: help, clear, info, mem, time, banner, test, ps, ls, calc, echo, ver, reboot\\n\\n\");\n    \n    char command[32];  // Buffer aumentado\n    char history[10][32];  // Historial de comandos\n    int history_count = 0;\n    \n    while (1) {\n        // Limpiar buffer completamente\n        for (int i = 0; i < 32; i++) {\n            command[i] = 0;\n        }\n        \n        // Mostrar prompt mejorado\n        vga_set_color(vga_entry_color(VGA_COLOR_LIGHT_CYAN, VGA_COLOR_BLACK));\n        vga_writestring(\"OriginOS\");\n        vga_set_color(vga_entry_color(VGA_COLOR_LIGHT_GREEN, VGA_COLOR_BLACK));\n        vga_writestring(\"@\");\n        vga_set_color(vga_entry_color(VGA_COLOR_LIGHT_BLUE, VGA_COLOR_BLACK));\n        vga_writestring(\"localhost\");\n        vga_set_color(vga_entry_color(VGA_COLOR_WHITE, VGA_COLOR_BLACK));\n        vga_writestring(\":~$ \");\n        \n        // Leer comando con validación ampliada\n        int pos = 0;\n        char ch;\n        \n        while (pos < 31) {\n            ch = keyboard_getchar();\n            \n            if (ch == '\\n') {\n                break;\n            }\n            else if (ch == '\\b' && pos > 0) {\n                pos--;\n                command[pos] = 0;\n                vga_writestring(\"\\b \\b\");\n            }\n            else if (ch >= 'a' && ch <= 'z') {\n                command[pos] = ch;\n                pos++;\n                vga_putchar(ch);\n            }\n            else if (ch >= 'A' && ch <= 'Z') {\n                command[pos] = ch + 32;\n                pos++;\n                vga_putchar(ch + 32);\n            }\n            else if (ch >= '0' && ch <= '9') {\n                command[pos] = ch;\n                pos++;\n                vga_putchar(ch);\n            }\n            else if (ch == ' ' || ch == '+' || ch == '-' || ch == '*' || ch == '/' || ch == '=') {\n                // Permitir espacios y operadores matemáticos\n                command[pos] = ch;\n                pos++;\n                vga_putchar(ch);\n            }\n        }\n        \n        command[pos] = 0;\n        vga_putchar('\\n');\n        \n        if (pos == 0) {\n            continue;\n        }\n        \n        // Guardar en historial\n        if (history_count < 10) {\n            for (int i = 0; i < 32; i++) {\n                history[history_count][i] = command[i];\n            }\n            history_count++;\n        }\n        \n        // Procesar comando avanzado\n        process_advanced_command(command);\n        vga_putchar('\\n');\n    }\n}\n\n// Implementación básica de strcmp\nint strcmp(const char* str1, const char* str2) {\n    while (*str1 && (*str1 == *str2)) {\n        str1++;\n        str2++;\n    }\n    return *(const unsigned char*)str1 - *(const unsigned char*)str2;\n}\n\n// Implementación básica de strncmp\nint strncmp(const char* str1, const char* str2, int n) {\n    while (n > 0 && *str1 && (*str1 == *str2)) {\n        str1++;\n        str2++;\n        n--;\n    }\n    if (n == 0) return 0;\n    return *(const unsigned char*)str1 - *(const unsigned char*)str2;\n}\n\n// === FUNCIONES DEL SISTEMA OPERATIVO ===\n\n// Información de memoria del sistema\nvoid show_memory_info(void) {\n    vga_set_color(vga_entry_color(VGA_COLOR_LIGHT_CYAN, VGA_COLOR_BLACK));\n    vga_writestring(\"=== INFORMACION DE MEMORIA ===\\n\");\n    vga_set_color(vga_entry_color(VGA_COLOR_WHITE, VGA_COLOR_BLACK));\n    vga_writestring(\"Memoria total: ~16MB (simulado)\\n\");\n    vga_writestring(\"Memoria usada por kernel: ~10KB\\n\");\n    vga_writestring(\"Memoria libre: ~15.9MB\\n\");\n    vga_writestring(\"Stack: 0x90000 - 0x9FFFF\\n\");\n    vga_writestring(\"Heap: No implementado\\n\");\n    vga_writestring(\"VGA Buffer: 0xB8000 - 0xBFFFF\\n\");\n}\n\n// Simulador de tiempo del sistema\nvoid show_system_time(void) {\n    static int hours = 14;\n    static int minutes = 30;\n    static int seconds = 0;\n    \n    // Simular incremento de tiempo\n    seconds += 5;\n    if (seconds >= 60) {\n        seconds = 0;\n        minutes++;\n        if (minutes >= 60) {\n            minutes = 0;\n            hours++;\n            if (hours >= 24) {\n                hours = 0;\n            }\n        }\n    }\n    \n    vga_set_color(vga_entry_color(VGA_COLOR_LIGHT_CYAN, VGA_COLOR_BLACK));\n    vga_writestring(\"=== TIEMPO DEL SISTEMA ===\\n\");\n    vga_set_color(vga_entry_color(VGA_COLOR_WHITE, VGA_COLOR_BLACK));\n    vga_writestring(\"Fecha: 12 de Julio, 2025\\n\");\n    vga_writestring(\"Hora: \");\n    \n    // Mostrar hora (formato simple)\n    if (hours < 10) vga_putchar('0');\n    print_number(hours);\n    vga_putchar(':');\n    if (minutes < 10) vga_putchar('0');\n    print_number(minutes);\n    vga_putchar(':');\n    if (seconds < 10) vga_putchar('0');\n    print_number(seconds);\n    vga_writestring(\"\\nUptime: Aproximadamente 5 minutos\\n\");\n}\n\n// Calculadora básica\nvoid calculator(const char* expression) {\n    vga_set_color(vga_entry_color(VGA_COLOR_LIGHT_CYAN, VGA_COLOR_BLACK));\n    vga_writestring(\"=== CALCULADORA ===\\n\");\n    vga_set_color(vga_entry_color(VGA_COLOR_WHITE, VGA_COLOR_BLACK));\n    \n    // Parser muy básico para operaciones simples\n    int num1 = 0, num2 = 0, result = 0;\n    char op = '+';\n    int i = 0;\n    \n    // Leer primer número\n    while (expression[i] >= '0' && expression[i] <= '9') {\n        num1 = num1 * 10 + (expression[i] - '0');\n        i++;\n    }\n    \n    // Leer operador\n    if (expression[i] == '+' || expression[i] == '-' || \n        expression[i] == '*' || expression[i] == '/') {\n        op = expression[i];\n        i++;\n    }\n    \n    // Leer segundo número\n    while (expression[i] >= '0' && expression[i] <= '9') {\n        num2 = num2 * 10 + (expression[i] - '0');\n        i++;\n    }\n    \n    // Calcular resultado\n    switch (op) {\n        case '+':\n            result = num1 + num2;\n            break;\n        case '-':\n            result = num1 - num2;\n            break;\n        case '*':\n            result = num1 * num2;\n            break;\n        case '/':\n            if (num2 != 0) {\n                result = num1 / num2;\n            } else {\n                vga_writestring(\"Error: Division por cero!\\n\");\n                return;\n            }\n            break;\n        default:\n            vga_writestring(\"Operacion no valida!\\n\");\n            vga_writestring(\"Uso: calc <num1><op><num2>\\n\");\n            vga_writestring(\"Ejemplo: calc 15+25\\n\");\n            return;\n    }\n    \n    vga_writestring(\"Expresion: \");\n    vga_writestring(expression);\n    vga_writestring(\"\\nResultado: \");\n    print_number(result);\n    vga_putchar('\\n');\n}\n\n// Lista de procesos simulados\nvoid show_processes(void) {\n    vga_set_color(vga_entry_color(VGA_COLOR_LIGHT_CYAN, VGA_COLOR_BLACK));\n    vga_writestring(\"=== LISTA DE PROCESOS ===\\n\");\n    vga_set_color(vga_entry_color(VGA_COLOR_WHITE, VGA_COLOR_BLACK));\n    vga_writestring(\"PID  NOMBRE           ESTADO    MEMORIA\\n\");\n    vga_writestring(\"---  ---------------  --------  -------\\n\");\n    vga_writestring(\"0    kernel           Running   10KB\\n\");\n    vga_writestring(\"1    vga_driver       Running   1KB\\n\");\n    vga_writestring(\"2    keyboard_driver  Running   512B\\n\");\n    vga_writestring(\"3    shell            Running   2KB\\n\");\n    vga_writestring(\"4    idle             Waiting   128B\\n\");\n    vga_writestring(\"\\nTotal: 5 procesos activos\\n\");\n}\n\n// Sistema de archivos simulado\nvoid list_files(void) {\n    vga_set_color(vga_entry_color(VGA_COLOR_LIGHT_CYAN, VGA_COLOR_BLACK));\n    vga_writestring(\"=== SISTEMA DE ARCHIVOS ===\\n\");\n    vga_set_color(vga_entry_color(VGA_COLOR_WHITE, VGA_COLOR_BLACK));\n    vga_writestring(\"Directorio: /\\n\");\n    vga_writestring(\"NOMBRE        TIPO     TAMAÑO\\n\");\n    vga_writestring(\"------------  -------  -------\\n\");\n    vga_set_color(vga_entry_color(VGA_COLOR_LIGHT_BLUE, VGA_COLOR_BLACK));\n    vga_writestring(\"boot/         DIR      -\\n\");\n    vga_writestring(\"kernel/       DIR      -\\n\");\n    vga_writestring(\"drivers/      DIR      -\\n\");\n    vga_set_color(vga_entry_color(VGA_COLOR_WHITE, VGA_COLOR_BLACK));\n    vga_writestring(\"readme.txt    FILE     1.2KB\\n\");\n    vga_writestring(\"config.sys    FILE     512B\\n\");\n    vga_writestring(\"autoexec.bat  FILE     256B\\n\");\n    vga_writestring(\"\\n6 elementos encontrados\\n\");\n    vga_writestring(\"Espacio libre: 1.4MB\\n\");\n}\n\n// Función auxiliar para imprimir números\nvoid print_number(int num) {\n    if (num == 0) {\n        vga_putchar('0');\n        return;\n    }\n    \n    if (num < 0) {\n        vga_putchar('-');\n        num = -num;\n    }\n    \n    char buffer[12];\n    int i = 0;\n    \n    while (num > 0) {\n        buffer[i++] = '0' + (num % 10);\n        num /= 10;\n    }\n    \n    // Imprimir al revés\n    while (i > 0) {\n        vga_putchar(buffer[--i]);\n    }\n}\n\n// Función echo mejorada\nvoid echo_command(const char* text) {\n    vga_set_color(vga_entry_color(VGA_COLOR_LIGHT_GREEN, VGA_COLOR_BLACK));\n    vga_writestring(text);\n    vga_putchar('\\n');\n    vga_set_color(vga_entry_color(VGA_COLOR_WHITE, VGA_COLOR_BLACK));\n}\n\n// Información detallada del sistema\nvoid show_detailed_system_info(void) {\n    vga_set_color(vga_entry_color(VGA_COLOR_LIGHT_CYAN, VGA_COLOR_BLACK));\n    vga_writestring(\"=== INFORMACION DETALLADA DEL SISTEMA ===\\n\");\n    vga_set_color(vga_entry_color(VGA_COLOR_WHITE, VGA_COLOR_BLACK));\n    vga_writestring(\"Sistema Operativo: OriginOS v2.0.0\\n\");\n    vga_writestring(\"Autor: Enrique Mendoza\\n\");\n    vga_writestring(\"Fecha de compilacion: 12 Julio 2025\\n\");\n    vga_writestring(\"Arquitectura: x86 (32-bit)\\n\");\n    vga_writestring(\"Procesador: Intel-compatible\\n\");\n    vga_writestring(\"Modo: Protegido (32-bit)\\n\\n\");\n    \n    vga_set_color(vga_entry_color(VGA_COLOR_LIGHT_GREEN, VGA_COLOR_BLACK));\n    vga_writestring(\"Componentes del Sistema:\\n\");\n    vga_set_color(vga_entry_color(VGA_COLOR_WHITE, VGA_COLOR_BLACK));\n    vga_writestring(\"  Bootloader: Custom BIOS (512 bytes)\\n\");\n    vga_writestring(\"  Kernel: Monolitico Avanzado (~12KB)\\n\");\n    vga_writestring(\"  Shell: v2.0 con historial y colores\\n\");\n    vga_writestring(\"  Drivers: VGA optimizado, Teclado PS/2\\n\\n\");\n    \n    vga_set_color(vga_entry_color(VGA_COLOR_LIGHT_BLUE, VGA_COLOR_BLACK));\n    vga_writestring(\"Funcionalidades:\\n\");\n    vga_set_color(vga_entry_color(VGA_COLOR_WHITE, VGA_COLOR_BLACK));\n    vga_writestring(\"  Gestion de memoria: Basica implementada\\n\");\n    vga_writestring(\"  Sistema de archivos: Simulado\\n\");\n    vga_writestring(\"  Calculadora: Operaciones aritmeticas\\n\");\n    vga_writestring(\"  Red: No implementada\\n\");\n    vga_writestring(\"  Multitarea: No implementada\\n\");\n    vga_writestring(\"  GUI: Modo texto avanzado\\n\");\n    vga_writestring(\"  Comandos: 13+ disponibles\\n\");\n}\n\n// Banner ASCII del sistema\nvoid show_banner(void) {\n    vga_set_color(vga_entry_color(VGA_COLOR_LIGHT_CYAN, VGA_COLOR_BLACK));\n    vga_writestring(\"  ___       _       _       ___  _____ \\n\");\n    vga_writestring(\" / _ \\\\ _ __(_) __ _(_)_ __ / _ \\\\/ _____|\\n\");\n    vga_writestring(\"| | | | '__| |/ _` | | '_ \\\\| | | \\\\___ \\\\ \\n\");\n    vga_writestring(\"| |_| | |  | | (_| | | | | | |_| |___) |\\n\");\n    vga_writestring(\" \\\\___/|_|  |_|\\\\__, |_|_| |_|\\\\___/|____/ \\n\");\n    vga_writestring(\"              |___/                    \\n\");\n    vga_set_color(vga_entry_color(VGA_COLOR_WHITE, VGA_COLOR_BLACK));\n    vga_writestring(\"Sistema Operativo desarrollado desde cero\\n\");\n    vga_writestring(\"Por Enrique Mendoza - 2025\\n\");\n}\n\n// Monitor del sistema\nvoid system_monitor(void) {\n    vga_set_color(vga_entry_color(VGA_COLOR_LIGHT_CYAN, VGA_COLOR_BLACK));\n    vga_writestring(\"=== MONITOR DEL SISTEMA ===\\n\");\n    vga_set_color(vga_entry_color(VGA_COLOR_WHITE, VGA_COLOR_BLACK));\n    vga_writestring(\"CPU: x86 Compatible\\n\");\n    vga_writestring(\"Uso de CPU: ~5% (estimado)\\n\");\n    vga_writestring(\"Temperatura: 45C (simulado)\\n\");\n    vga_writestring(\"Interrupciones: Deshabilitadas\\n\");\n    vga_writestring(\"Modo de procesador: Protegido 32-bit\\n\");\n    vga_writestring(\"Cache: No implementado\\n\");\n    vga_writestring(\"Errores de pagina: 0\\n\");\n    vga_writestring(\"Context switches: No implementado\\n\");\n}\n\n// Comando de ayuda avanzada\nvoid show_advanced_help(void) {\n    vga_set_color(vga_entry_color(VGA_COLOR_LIGHT_CYAN, VGA_COLOR_BLACK));\n    vga_writestring(\"=== AYUDA AVANZADA DE ORIGINOS ===\\n\");\n    vga_set_color(vga_entry_color(VGA_COLOR_WHITE, VGA_COLOR_BLACK));\n    vga_writestring(\"COMANDOS BASICOS:\\n\");\n    vga_writestring(\"  help, clear, about, reboot\\n\\n\");\n    vga_writestring(\"INFORMACION DEL SISTEMA:\\n\");\n    vga_writestring(\"  info  - Informacion completa\\n\");\n    vga_writestring(\"  mem   - Estado de memoria\\n\");\n    vga_writestring(\"  time  - Fecha y hora\\n\");\n    vga_writestring(\"  mon   - Monitor del sistema\\n\\n\");\n    vga_writestring(\"HERRAMIENTAS:\\n\");\n    vga_writestring(\"  calc <expr> - Calculadora (15+25)\\n\");\n    vga_writestring(\"  echo <text> - Repetir texto\\n\\n\");\n    vga_writestring(\"GESTION:\\n\");\n    vga_writestring(\"  ps    - Lista de procesos\\n\");\n    vga_writestring(\"  ls    - Lista de archivos\\n\\n\");\n    vga_writestring(\"OTROS:\\n\");\n    vga_writestring(\"  banner - Mostrar banner del sistema\\n\");\n    vga_writestring(\"  ver    - Version del sistema\\n\");\n}\n\n// Función avanzada para procesar comandos\nvoid process_advanced_command(const char* cmd) {\n    // Comando help\n    if (cmd[0] == 'h' && cmd[1] == 'e' && cmd[2] == 'l' && cmd[3] == 'p' && cmd[4] == 0) {\n        vga_set_color(vga_entry_color(VGA_COLOR_LIGHT_CYAN, VGA_COLOR_BLACK));\n        vga_writestring(\"=== AYUDA COMPLETA DE ORIGINOS ===\\n\");\n        vga_set_color(vga_entry_color(VGA_COLOR_WHITE, VGA_COLOR_BLACK));\n        vga_writestring(\"Comandos del Sistema:\\n\");\n        vga_writestring(\"  help      - Mostrar esta ayuda\\n\");\n        vga_writestring(\"  clear     - Limpiar pantalla\\n\");\n        vga_writestring(\"  info      - Informacion del sistema\\n\");\n        vga_writestring(\"  ver       - Version del OS\\n\");\n        vga_writestring(\"  reboot    - Reiniciar sistema\\n\\n\");\n        vga_writestring(\"Informacion:\\n\");\n        vga_writestring(\"  mem       - Estado de memoria\\n\");\n        vga_writestring(\"  time      - Fecha y hora\\n\");\n        vga_writestring(\"  ps        - Lista de procesos\\n\");\n        vga_writestring(\"  ls        - Lista de archivos\\n\\n\");\n        vga_writestring(\"Herramientas:\\n\");\n        vga_writestring(\"  calc 5+3  - Calculadora\\n\");\n        vga_writestring(\"  echo hola - Repetir texto\\n\");\n        vga_writestring(\"  banner    - Banner del sistema\\n\");\n        vga_writestring(\"  test      - Prueba del sistema\\n\");\n    }\n    // Comando clear\n    else if (cmd[0] == 'c' && cmd[1] == 'l' && cmd[2] == 'e' && cmd[3] == 'a' && cmd[4] == 'r' && cmd[5] == 0) {\n        vga_clear();\n        vga_set_color(vga_entry_color(VGA_COLOR_LIGHT_GREEN, VGA_COLOR_BLACK));\n        vga_writestring(\"Pantalla limpiada correctamente.\\n\");\n        vga_set_color(vga_entry_color(VGA_COLOR_WHITE, VGA_COLOR_BLACK));\n    }\n    // Comando info\n    else if (cmd[0] == 'i' && cmd[1] == 'n' && cmd[2] == 'f' && cmd[3] == 'o' && cmd[4] == 0) {\n        show_detailed_system_info();\n    }\n    // Comando mem\n    else if (cmd[0] == 'm' && cmd[1] == 'e' && cmd[2] == 'm' && cmd[3] == 0) {\n        show_memory_info();\n    }\n    // Comando time\n    else if (cmd[0] == 't' && cmd[1] == 'i' && cmd[2] == 'm' && cmd[3] == 'e' && cmd[4] == 0) {\n        show_system_time();\n    }\n    // Comando ps\n    else if (cmd[0] == 'p' && cmd[1] == 's' && cmd[2] == 0) {\n        show_processes();\n    }\n    // Comando ls\n    else if (cmd[0] == 'l' && cmd[1] == 's' && cmd[2] == 0) {\n        list_files();\n    }\n    // Comando ver\n    else if (cmd[0] == 'v' && cmd[1] == 'e' && cmd[2] == 'r' && cmd[3] == 0) {\n        vga_set_color(vga_entry_color(VGA_COLOR_LIGHT_GREEN, VGA_COLOR_BLACK));\n        vga_writestring(\"=== VERSION DEL SISTEMA ===\\n\");\n        vga_set_color(vga_entry_color(VGA_COLOR_WHITE, VGA_COLOR_BLACK));\n        vga_writestring(\"OriginOS version 2.0.0\\n\");\n        vga_writestring(\"Build: 12-Julio-2025 22:50:00\\n\");\n        vga_writestring(\"Kernel: Monolitico Avanzado\\n\");\n        vga_writestring(\"Shell: v2.0 con control avanzado\\n\");\n        vga_writestring(\"Compilador: i686-elf-gcc\\n\");\n        vga_writestring(\"Arquitectura: x86 32-bit\\n\");\n    }\n    // Comando reboot\n    else if (cmd[0] == 'r' && cmd[1] == 'e' && cmd[2] == 'b' && cmd[3] == 'o' && cmd[4] == 'o' && cmd[5] == 't' && cmd[6] == 0) {\n        vga_set_color(vga_entry_color(VGA_COLOR_LIGHT_RED, VGA_COLOR_BLACK));\n        vga_writestring(\"Reiniciando OriginOS...\\n\");\n        vga_writestring(\"Hasta pronto!\\n\");\n        vga_set_color(vga_entry_color(VGA_COLOR_WHITE, VGA_COLOR_BLACK));\n        // Trigger triple fault para reiniciar\n        __asm__ volatile (\"int $0x3\");\n    }\n    // Comando test\n    else if (cmd[0] == 't' && cmd[1] == 'e' && cmd[2] == 's' && cmd[3] == 't' && cmd[4] == 0) {\n        vga_set_color(vga_entry_color(VGA_COLOR_LIGHT_GREEN, VGA_COLOR_BLACK));\n        vga_writestring(\"=== PRUEBA DEL SISTEMA ===\\n\");\n        vga_set_color(vga_entry_color(VGA_COLOR_WHITE, VGA_COLOR_BLACK));\n        vga_writestring(\"✓ Kernel funcionando correctamente\\n\");\n        vga_writestring(\"✓ Driver VGA operativo\\n\");\n        vga_writestring(\"✓ Driver de teclado funcional\\n\");\n        vga_writestring(\"✓ Shell v2.0 estable\\n\");\n        vga_writestring(\"✓ Sistema de comandos activo\\n\");\n        vga_set_color(vga_entry_color(VGA_COLOR_LIGHT_GREEN, VGA_COLOR_BLACK));\n        vga_writestring(\"Estado: TODO OK!\\n\");\n        vga_set_color(vga_entry_color(VGA_COLOR_WHITE, VGA_COLOR_BLACK));\n    }\n    // Comando banner\n    else if (cmd[0] == 'b' && cmd[1] == 'a' && cmd[2] == 'n' && cmd[3] == 'n' && cmd[4] == 'e' && cmd[5] == 'r' && cmd[6] == 0) {\n        show_banner();\n    }\n    // Comando calc con argumentos\n    else if (cmd[0] == 'c' && cmd[1] == 'a' && cmd[2] == 'l' && cmd[3] == 'c' && cmd[4] == ' ') {\n        calculator(cmd + 5);\n    }\n    // Comando echo con argumentos\n    else if (cmd[0] == 'e' && cmd[1] == 'c' && cmd[2] == 'h' && cmd[3] == 'o' && cmd[4] == ' ') {\n        echo_command(cmd + 5);\n    }\n    // Comando desconocido\n    else {\n        vga_set_color(vga_entry_color(VGA_COLOR_LIGHT_RED, VGA_COLOR_BLACK));\n        vga_writestring(\"Comando desconocido: \");\n        vga_writestring(cmd);\n        vga_writestring(\"\\n\");\n        vga_set_color(vga_entry_color(VGA_COLOR_WHITE, VGA_COLOR_BLACK));\n        vga_writestring(\"Escribe 'help' para ver todos los comandos disponibles.\\n\");\n    }\n}\n\nvoid kernel_main(void) {\n    // Inicializar drivers\n    vga_initialize();\n    keyboard_initialize();\n    \n    // Mostrar pantalla de bienvenida\n    show_welcome_screen();\n    \n    // Esperar una tecla\n    keyboard_getchar();\n    \n    // Iniciar shell simple\n    simple_shell();\n    \n    // El kernel nunca debería llegar aquí\n    kernel_panic(\"Kernel terminated unexpectedly!\");\n}\n\nvoid kernel_panic(const char* message) {\n    vga_set_color(vga_entry_color(VGA_COLOR_WHITE, VGA_COLOR_RED));\n    vga_clear();\n    vga_writestring(\"KERNEL PANIC: \");\n    vga_writestring(message);\n    vga_writestring(\"\\nSistema detenido.\");\n    \n    // Deshabilitar interrupciones y hacer halt\n    __asm__ volatile (\"cli; hlt\");\n    \n    // Loop infinito por si acaso\n    while (1) {\n        __asm__ volatile (\"hlt\");\n    }\n}"